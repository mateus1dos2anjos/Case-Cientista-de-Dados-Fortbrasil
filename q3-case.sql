CREATE DATABASE q3_case;

CREATE TABLE d_Tempo (ID_TEMPO INT, DT_REF DATE, NU_SEMANA INT, NU_MES INT, NU_TRIMESTRE INT, NU_ANO INT);
CREATE TABLE f_Vendas (ID_VENDA INT, VL_VENDA FLOAT, NU_VENDA INT, VL_LUCRO FLOAT, VL_CUSTO FLOAT, ID_LOJA INT, ID_TEMPO INT, ID_PESSOA INT);
CREATE TABLE d_Loja (ID_LOJA INT, DS_NOME VARCHAR(70), DS_UF VARCHAR(2), DS_CIDADE VARCHAR(30), DS_EMPRESA VARCHAR(150), NU_CEP INT);
CREATE TABLE d_Pessoa (ID_PESSOA INT, NM_PESSOA VARCHAR(70));


INSERT INTO d_Tempo (ID_TEMPO, DT_REF, NU_SEMANA, NU_MES, NU_TRIMESTRE, NU_ANO) VALUES (1, '02/01/2020', 1, 1, 1,2020);  /* JAN - CE */
INSERT INTO d_Tempo (ID_TEMPO, DT_REF, NU_SEMANA, NU_MES, NU_TRIMESTRE, NU_ANO) VALUES (2, '2020-01-05', 1, 1, 1,2020);  /* JAN - CE */
INSERT INTO d_Tempo (ID_TEMPO, DT_REF, NU_SEMANA, NU_MES, NU_TRIMESTRE, NU_ANO) VALUES (3, '2020-01-05', 1, 1, 1, 2020); /* JAN - BA */
INSERT INTO d_Tempo (ID_TEMPO, DT_REF, NU_SEMANA, NU_MES, NU_TRIMESTRE, NU_ANO) VALUES (4, '2020-02-05', 1, 2, 1, 2020); /* FEV - PE */


INSERT INTO f_Vendas (ID_VENDA, VL_VENDA, NU_VENDA, VL_LUCRO, VL_CUSTO, ID_LOJA, ID_TEMPO, ID_PESSOA) VALUES (1, 50.30, 1, 10.20, 40.10, 1, 1, 1);
INSERT INTO f_Vendas (ID_VENDA, VL_VENDA, NU_VENDA, VL_LUCRO, VL_CUSTO, ID_LOJA, ID_TEMPO, ID_PESSOA) VALUES (2, 40.30, 2, 5.20, 30.10, 1, 2, 1);
INSERT INTO f_Vendas (ID_VENDA, VL_VENDA, NU_VENDA, VL_LUCRO, VL_CUSTO, ID_LOJA, ID_TEMPO, ID_PESSOA) VALUES (3, 60.30, 3, 20.20, 50.10, 2, 3, 1);
INSERT INTO f_Vendas (ID_VENDA, VL_VENDA, NU_VENDA, VL_LUCRO, VL_CUSTO, ID_LOJA, ID_TEMPO, ID_PESSOA) VALUES (4, 200.30, 4, 40.20, 180.10, 3, 4, 2);


INSERT INTO d_Loja (ID_LOJA, DS_NOME, DS_UF, DS_CIDADE, DS_EMPRESA, NU_CEP) VALUES (1, 'Lojas Americanas', 'CE', 'Quixadá', 'Feita para voçê.', 63900050);
INSERT INTO d_Loja (ID_LOJA, DS_NOME, DS_UF, DS_CIDADE, DS_EMPRESA, NU_CEP) VALUES (2, 'Casa Freitas', 'BA', 'Salvador', 'Feita para voçê.', 33900010);
INSERT INTO d_Loja (ID_LOJA, DS_NOME, DS_UF, DS_CIDADE, DS_EMPRESA, NU_CEP) VALUES (3, 'Zara', 'PE', 'Olinda', 'Feita para você.', 43900010);


INSERT INTO d_Pessoa (ID_PESSOA, NM_PESSOA) VALUES (1, 'Mateus'); 
INSERT INTO d_Pessoa (ID_PESSOA, NM_PESSOA) VALUES (2, 'Junior'); 




SELECT * FROM 


/* QUESTAO 3.1 */

SELECT P.ID_PESSOA, P.NM_PESSOA, T.NU_MES, T.NU_ANO, F.VL_VENDA FROM d_pessoa P , f_vendas F, d_Tempo T, d_loja D WHERE T.NU_ANO = 2020 AND T.NU_MES = 1 AND D.DS_UF = 'CE' AND P.ID_PESSOA = F.ID_PESSOA AND F.ID_LOJA = D.ID_LOJA AND F.ID_TEMPO = T.ID_TEMPO;


/* QUESTAO 3.2 */

SELECT P.ID_PESSOA, COUNT(*) AS QTD_DE_COMPRAS FROM d_pessoa P, f_vendas V, d_tempo T WHERE P.ID_PESSOA = V.ID_PESSOA AND V.ID_TEMPO = T.ID_TEMPO AND T.NU_ANO = 2020 AND T.NU_MES = 3;


